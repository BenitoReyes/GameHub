generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String            @id @default(uuid())
  password         String
  username         String            @unique
  createdAt        DateTime          @default(now())
  totalGames       Int               @default(0)
  leaderboards     Leaderboard[]
  rooms            Room[]            @relation("RoomHost")
  roomParticipants RoomParticipant[]
}

model Room {
  id           String            @id @default(uuid())
  hostId       String
  isPublic     Boolean           @default(true)
  createdAt    DateTime          @default(now())
  board        Json
  redScore     Int               @default(0)
  blueScore    Int               @default(0)
  inRoom       Int               @default(0)
  gameType     String            @default("drop4")
  host         User              @relation("RoomHost", fields: [hostId], references: [id])
  participants RoomParticipant[]
}

model RoomParticipant {
  id         Int        @id @default(autoincrement())
  userId     String
  roomId     String
  permission Permission
  joinedAt   DateTime   @default(now())
  messages   Message[]
  room       Room       @relation(fields: [roomId], references: [id])
  user       User       @relation(fields: [userId], references: [id])

  @@unique([userId, roomId])
}

model Message {
  id          Int             @id @default(autoincrement())
  roomId      String
  senderId    String
  text        String
  timestamp   DateTime        @default(now())
  participant RoomParticipant @relation(fields: [senderId, roomId], references: [userId, roomId])
}

model Leaderboard {
  id        Int      @id @default(autoincrement())
  gameType  String
  userId    String
  wins      Int      @default(0)
  updatedAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@unique([gameType, userId])
}

enum Permission {
  HOST
  PLAYER
  SPECTATOR
}
