generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String            @id @default(uuid())
  password         String
  username         String            @unique
  createdAt        DateTime          @default(now())
  rooms            Room[]            @relation("RoomHost")
  roomParticipants RoomParticipant[]
}

model Room {
  id           String            @id @default(uuid())
  hostId       String
  isPublic     Boolean           @default(true)
  createdAt    DateTime          @default(now())
  host         User              @relation("RoomHost", fields: [hostId], references: [id])
  participants RoomParticipant[]
}

model Message {
  id          Int             @id @default(autoincrement())
  roomId      String
  senderId    String
  text        String
  timestamp   DateTime        @default(now())
  participant RoomParticipant @relation(fields: [senderId, roomId], references: [userId, roomId])
}

model RoomParticipant {
  id       Int       @id @default(autoincrement())
  userId   String
  roomId   String
  role     Role
  joinedAt DateTime  @default(now())
  user     User      @relation(fields: [userId], references: [id])
  room     Room      @relation(fields: [roomId], references: [id])
  messages Message[]

  @@unique([userId, roomId])
}

enum Role {
  HOST
  PLAYER
  SPECTATOR
}
