<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Drop 4 - Join Game</title>
    <link rel="stylesheet" href="../../Assets/styles.css" />
</head>
<body class="join-game">
    <a href="drop4Menu.html" class="back-btn">â—„ BACK</a>

    <div class="floating-chip chip-1">ğŸ”´</div>
    <div class="floating-chip chip-2">ğŸ”µ</div>
    <div class="floating-chip chip-3">ğŸ”´</div>
    <div class="floating-chip chip-4">ğŸ”µ</div>
    <div class="searchContainer">
        <h1>Join a Game Room</h1>
            <input type="text" id="roomIdInput" placeholder="Enter roomId">
            <button id="joinRoom">Join Room</button>
    </div>
    <div class="join-container">
        <div class="icon-container"> <button id="searchBtn" class="searchBtn">ğŸ”</button> </div>
        <h1>AVAILABLE ROOMS</h1>
        <div id="roomList" style="max-height: 300px; overflow-y: auto; margin-top: 20px; color: #fff; font-size: 12px; letter-spacing: 1px;">
            <!-- Room entries will be populated here -->
        </div>
    </div> 

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="drop4logic.js"></script>
    <script type="module">
        import { getSocket } from '../commonLogic/socket.js';
        const socket = getSocket();

        document.getElementById('searchBtn').addEventListener('click', () => {
            document.querySelector('.join-container').style.display = 'none';
            document.querySelector('.searchContainer').style.display = 'block';
        });

        document.getElementById('joinRoom').addEventListener('click', async () => {
            const roomId = document.getElementById('roomIdInput').value;
            socket.emit('join-game', roomId);
        });
        // request only drop4 rooms to reduce traffic
        socket.emit('get-rooms', { gameType: 'drop4' });
        setInterval(()=>{ socket.emit('get-rooms', { gameType: 'drop4' }); }, 2500);
        socket.on('room-list', (rooms) => {
            console.log('drop4 JoinGame received rooms:', rooms);
            const filtered = Array.isArray(rooms) ? rooms.filter(r => r.gameType === 'drop4') : [];
            if (!filtered || filtered.length === 0) {
                document.getElementById('roomList').innerHTML = '<div style="color:#fff; padding: 12px;">No active Drop4 rooms yet. Create one from the menu!</div>';
                return;
            }
            document.getElementById('roomList').innerHTML = filtered.map(room => `
                <div class="room-entry">
                    <div class = "room-info">
                        <span>Username: ${room.host.username}</span>
                        <span>, Participants: ${room.participants.length}</span>
                        <span>, Spectators: ${room.participants.length <= 2 ? 0 : room.participants.length - 2}</span>
                    </div>
                    <button id="joinBtn" class="joinBtn" data-roomId="${room.id}">Join</button> 
                </div>
            `).join('');
            document.querySelectorAll('.joinBtn').forEach(button => {
                button.addEventListener('click', () => {
                    const roomId = button.getAttribute('data-roomId');
                    socket.emit('join-game', roomId);
                });
            });
        });
    </script>
    </body>
</html>