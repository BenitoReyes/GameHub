<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Join Game</title>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <div class="join-container">
            <h1>Join a Game Room</h1>
            <input type="text" id="usernameInput" placeholder="Enter Username" />
            <button id="joinRoom">Join Room</button>
        </div>
        <div class="room-list-container">
            <h2>Available Rooms</h2>
            <div id="roomList"></div>
        </div>
        <script src="/socket.io/socket.io.js"></script>
        <script src="script.js"></script>
        <script>
            document.getElementById('joinRoom').addEventListener('click', async () => {
                const username = document.getElementById('usernameInput').value;
                socket.emit('join-game', username);
            });
            socket.emit('get-rooms');
            // called when manually joined
            socket.on('room-list', (rooms) => {
                document.getElementById('roomList').innerHTML = rooms.map(room => `
                    <div class="room-entry">
                        <span>Username: ${room.host.username}</span>
                        <span>, Participants: ${room.participants.length}</span>
                        <span>, Spectators: ${room.participants.length <= 2 ? 0 : room.participants.length - 2}</span>
                        <button class="joinBtn" data-room-hostUsername="${room.host.username}">Join</button> 
                    </div>
                `).join('');
                document.querySelectorAll('.joinBtn').forEach(button => {
                    button.addEventListener('click', () => {
                        const roomHostUsername = button.getAttribute('data-room-hostUsername');
                        socket.emit('join-game', roomHostUsername);
                    });
                });
            });
        </script>
    </body>
</html>